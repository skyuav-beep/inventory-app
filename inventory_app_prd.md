# 📦 상품 재고관리 앱 PRD (v1.1)

**작성자:** Steve Kim  
**목적:** 모바일 반응형 UI를 지원하는 상품 재고관리 시스템 구축

---

## 1. 🎯 프로젝트 개요

### 1.1 목적

본 앱은 상품의 **입고, 출고, 반품 및 실시간 재고 상태**를 효율적으로 관리하기 위한 웹/모바일 반응형 관리 도구이다.

### 1.2 주요 사용자

- **내부 사용자(사내 계정만 접근 가능)**: 환경설정에서 사용자 계정을 생성/비활성화.
- **권한 모델**: 사용자별로 **읽기/쓰기 권한**을 화면/리소스 단위(대시보드, 제품, 입고, 출고, 반품, 환경설정)로 부여.

### 1.3 목표

- ✅ 실시간 재고 집계 및 시각화
- ✅ **안전재고 수량(최소 보유수량) 관리** 및 **재고 부족 알림(텔레그램 공지)**
- ✅ 모바일/데스크탑 반응형 UI 제공
- ✅ 직관적 모달 기반 입력/검증 UX

---

## 2. 🧭 UI / UX 설계

### 2.1 공통 레이아웃 (반응형 디자인)

| 구분                     | 데스크탑                    | 모바일                               |
| ------------------------ | --------------------------- | ------------------------------------ |
| **사이드바(Sidebar)**    | 고정형 좌측 메뉴            | 햄버거 버튼(☰)으로 접힘/열림 토글   |
| **상단바(Top Bar)**      | 페이지 타이틀 + 사용자 메뉴 | 상단 고정 타이틀바 (뒤로가기 + 메뉴) |
| **메인영역(Main Panel)** | 표/차트 중심 3단 구조       | 카드형 리스트 UI로 자동 전환         |

**UX 정책:**

- 모든 모달은 모바일에서 전체화면(full-screen modal)로 전환.
- 주요 CTA 버튼(등록, 저장 등)은 하단 고정 Floating 버튼으로 배치.
- 스크롤 대비 영역 구분은 그림자 효과로 표현.

---

## 3. 📊 주요 기능

### 3.1 대시보드

- **목적:** 전체 재고 상태와 위험(부족) 품목을 한눈에 파악
- **데이터:**
  - 제품별 남은 수량, 총 입고/출고/반품 집계
  - **제품별 안전재고 수량 대비 상태(정상/주의/부족)**
  - **재고 부족 알림 큐(최근 N건, 미확인 건수)**
  - 월별 입출고 추세 그래프
- **UX:**
  - 데스크탑: 차트/카드 3열 배치 + 부족품목 테이블 고정
  - 모바일: 카드/차트 캐러셀 + **부족품목 상단 강조 배너**
- **상태 규칙:**
  - `남은수량 ≥ 안전재고수량` → 정상
  - `남은수량 < 안전재고수량` → 부족(알림 대상)
  - 임계 비율(예: 안전재고의 120% 미만) → 주의

---

### 3.2 제품리스트

- **목적:** 제품 마스터 및 안전재고 관리
- **항목:** 제품코드, 제품명, 설명, 입고수량, 출고수량, 남은수량, **안전재고수량**, **상태(정상/주의/부족)**
- **UX:**
  - 데스크탑: 테이블 뷰 + 인라인 편집(안전재고수량)
  - 모바일: 카드형 리스트 (핵심 수량 및 상태 배지 강조)
- **제품 등록 모달:**
  - 제품코드, 제품명, 설명
  - **안전재고수량 입력 필드** (필수/0 허용 여부는 정책에 따름)
  - 모바일에서는 하단 고정 등록 버튼

---

### 3.3 입고리스트

- **목적:** 입고 내역 등록 및 관리
- **항목:** 입고ID, 제품코드, 수량, 입고일자, 비고
- **입고 등록 모달:**
  - 제품선택(드롭다운)
  - 수량, 입고일자, 비고 입력
  - 모바일 전체화면 입력 폼 + Floating 등록 버튼

---

### 3.4 출고리스트

- **목적:** 출고 내역 관리 및 출고 등록
- **항목:** 출고ID, 제품코드, 수량, 출고일자, 비고
- **출고 등록 모달:**
  - 제품선택, 수량, 일자, 비고
  - 모바일: 한 손 조작 가능 구조 (입력 필드 수직 배열)

---

### 3.5 반품리스트

- **목적:** 반품 내역 기록 및 사유 관리
- **항목:** 반품ID, 제품코드, 수량, 반품사유, 처리상태
- **반품 등록 모달:**
  - 제품선택, 반품수량, 사유, 처리상태
  - 반응형 전체화면 모달 + 상단 제목바 표시

---

### 3.6 데이터 업로드(즉시 적용)

- **대상:** 입고/출고 이력 벌크 등록 (Excel/CSV)
- **포맷:**
  - **입고 템플릿 컬럼:** `product_code, quantity, date_in(YYYY-MM-DD), note`
  - **출고 템플릿 컬럼:** `product_code, quantity, date_out(YYYY-MM-DD), note`
- **검증:** 제품코드 존재 여부, 수량>0, 날짜 형식, 중복행 제거 옵션
- **결과:** 성공/실패 행 리포트 다운로드, 실패 사유 표시

---

### 3.7 알림 채널(즉시 적용)

- **기본:** 텔레그램(필수)
- **추가:** Slack, Email(환경설정에서 On/Off)
- **정책:** 쿨다운, 심야 억제, 배치/즉시 발송, 권한별 수신 대상 지정

---

## 4. ⚙️ 데이터 구조 (요약)

⚙️ 데이터 구조 (요약)

```yaml
Product:
  id: string
  name: string
  description: string
  total_in: number
  total_out: number
  total_return: number
  stock_remain: number

Inbound:
  id: string
  product_id: string
  quantity: number
  date_in: datetime
  note: string

Outbound:
  id: string
  product_id: string
  quantity: number
  date_out: datetime
  note: string

Return:
  id: string
  product_id: string
  quantity: number
  reason: string
  status: [대기, 완료]
  date_return: datetime
```

---

## 5. 🔄 로직 플로우

1. **제품 등록 →** product 테이블 신규 생성
2. **입고 등록 →** inbound 추가 후 product.total_in 업데이트
3. **출고 등록 →** outbound 추가 후 product.total_out 업데이트
4. **반품 등록 →** return 추가 후 승인 시 product.total_return 반영
5. **대시보드 갱신 →** 실시간 집계 (stock_remain 계산)

---

## 6. 🔐 접근 권한

- **접근 주체:** 사내 내부 사용자만 접근(사설망/VPN 또는 사내 SSO 연동 가능성 고려).
- **인증:** 이메일+비밀번호(기본), 필요 시 SSO 확장.
- **권한 부여 단위:** 화면/리소스 단위로 **읽기/쓰기**를 개별 지정.
  - 리소스: 대시보드, 제품, 입고, 출고, 반품, 환경설정
- **권한 템플릿(예시):**
  - 관리자(Admin): 전체 읽기/쓰기
  - 담당자(Operator): 제품/입고/출고/반품 쓰기, 대시보드/조회 가능, 환경설정 읽기만
  - 조회자(Viewer): 전체 읽기 전용
    ------|------|
    | **Admin** | CRUD 전체 권한 |
    | **User** | 조회(Read Only) |

---

## 7. 📱 반응형 UX 세부 정책

- 최소 해상도: 360px 기준 (모바일 세로)
- CSS Grid + Flex 조합으로 재배치 자동화
- 카드 리스트 및 테이블 자동 변환 (Breakpoints 768px, 1024px)
- 터치 이벤트 중심 UI (탭 기반 네비게이션)
- **모달 전환 정책:** 모바일 전체화면, 데스크탑 중앙 고정
- **언어/지역화:** **한국어 전용** UI (날짜/숫자/통화 표기 한국어 규칙 적용)

---

## 7.1 🎨 컬러 시스템 (이미지 기반 추출)

첨부 이미지에서 추출한 대표 팔레트와 토큰(예시):

- **Brand Primary (보라/자줏빛):** `#3e2833`
- **Brand Secondary (딥틸/그린):** `#1c534f`
- **Accent Neutral Brown:** `#615340`
- **Accent Taupe:** `#786a60`
- **Neutral Light (Surface):** `#d8d9d7`
- **Neutral Dark (Text Primary):** `#221d23`
- **Support Neutral:** `#9b8f80`, `#c6b7a4`

**역할 매핑:**

- 배경/표면: `surface(#d8d9d7)`, `surface_alt(#f6f6f6)`
- 본문 텍스트: `text_primary(#221d23)` / 반전 텍스트: `text_inverse(#ffffff)`
- 강조 버튼/링크: `brand_primary(#3e2833)` / 보조 요소: `brand_secondary(#1c534f)`
- 경고/성공/위험: `warning(#e9c46a)` / `success(#2a9d8f)` / `danger(#e63946)`

**Tailwind Theme 예시:**

```json
{
  "colors": {
    "brand": { "primary": "#3e2833", "secondary": "#1c534f" },
    "accent": { "orange": "#615340", "taupe": "#786a60" },
    "neutral": { "50": "#f6f6f6", "100": "#d8d9d7", "900": "#221d23" },
    "success": "#2a9d8f",
    "warning": "#e9c46a",
    "danger": "#e63946"
  }
}
```

**다운로드:** 팔레트 JSON과 스와치 이미지는 첨부 링크 참조.

---

## 7.2 🧩 컴포넌트 가이드(모바일 우선)

**네비게이션**

- **사이드바/드로어:** 모바일 햄버거 → 전체화면 드로어. 메뉴 아이템에 아이콘 + 라벨.
- **상단바:** 타이틀 좌측 정렬, 우측에 알림벨/설정 아이콘.

**데이터 표시**

- **카드형 품목 리스트:** 제품명, 코드, 남은수량, 상태 배지(정상/주의/부족). 탭 시 상세.
- **테이블(데스크탑):** 고정 헤더, 열 정렬/필터, 행 선택.
- **배지:** 상태색 — 정상: brand_secondary 20% 배경, 주의: warning, 부족: danger.

**입력/행동**

- **모달(풀스크린 on 모바일):** 제품 등록/입고/출고/반품 공통 폼. 하단 고정 CTA.
- **숫자 입력 스텝퍼:** 수량 ± 컨트롤, 긴급 스캔 버튼(추후 바코드) 자리 확보.
- **검색/필터 바:** 상단 고정, 키워드 + 드롭다운(기간/상태/카테고리).

**알림/토스트**

- **재고부족 알림 배너:** 상단 고정, 클릭 시 부족 리스트로 이동.
- **토스트:** 저장/실패/권한 안내.

---

## 7.3 🔣 아이콘 세트 (lucide-react)

- **대시보드:** `LayoutDashboard`
- **제품리스트:** `Package` 또는 `Boxes`
- **입고리스트:** `Truck` 또는 `Download`
- **출고리스트:** `Truck` + `Upload` 조합 혹은 `Send`
- **반품리스트:** `Undo2` 또는 `RotateCcw`
- **재고부족/알림:** `Bell`, `AlertTriangle`
- **검색/필터:** `Search`, `Filter`
- **설정:** `Settings`
- **사용자/권한:** `Users`, `ShieldCheck`

아이콘 컬러는 `text_primary` 기본, 강조/경고는 역할 색상 사용.

---

## 8. 🚀 향후 확장 기능

- **바코드 스캔 입/출고 자동 입력** _(유일한 향후 확장 항목)_

> 그 외 항목(Excel 업로드, 추가 알림 채널)은 **즉시 적용 범위**로 상향 반영되었습니다.

---

## 9. 💡 기술 스택 제안

| 영역          | 기술                                            |
| ------------- | ----------------------------------------------- |
| Frontend      | React + TypeScript + Tailwind + Zustand         |
| Backend       | Node.js (NestJS / Express)                      |
| Database      | PostgreSQL                                      |
| Infra         | Docker + Nginx                                  |
| Auth          | JWT 기반 인증                                   |
| Notifications | **Telegram Bot API** (봇 토큰/채팅ID 기반 알림) |
| ------        | ------                                          |
| Frontend      | React + TypeScript + Tailwind + Zustand         |
| Backend       | Node.js (NestJS / Express)                      |
| Database      | PostgreSQL                                      |
| Infra         | Docker + Nginx                                  |
| Auth          | JWT 기반 인증                                   |

## 10. ⚙️ 환경설정(설정/관리)

### 10.1 사용자/권한 관리

- 사용자 생성/비활성화, 비밀번호 초기화
- 사용자별 **읽기/쓰기 권한**을 리소스 단위로 설정(대시보드/제품/입고/출고/반품/환경설정)
- 권한 템플릿(관리자/담당자/조회자) 복사 후 개별 수정 가능

### 10.2 알림 정책

- **안전재고 기준값**: 제품별 안전재고수량 관리(필수)
- **임계 비율 설정**: 주의 임계치(예: 안전재고의 120%), 부족 임계치(100%)
- **발송 조건**: `남은수량 < 안전재고수량` 시 즉시 발송 또는 **배치/지연 통지(예: 10분 단위)**
- **중복 억제**: 동일 품목 반복 알림 쿨다운(예: 1시간)

### 10.3 텔레그램 설정 + 사용 설명(내부 문서)

#### ① 봇 토큰 발행 (BotFather)

1. 텔레그램에서 `@BotFather` 대화 시작 → **/newbot** 입력
2. 봇 이름과 사용자이름(@handle) 등록
3. 발급된 **HTTP API Token** 복사 → 환경변수 `TELEGRAM_BOT_TOKEN` 저장

#### ② 채팅/그룹 준비 및 Chat ID 획득

- **개인 알림:** 봇을 친구 추가 후 아무 메시지 전송
- **그룹 알림:** 그룹 생성 → 봇 초대 → 그룹에서 아무 메시지 전송
- **Chat ID 조회 방법(택1):**
  - (간편) `https://api.telegram.org/bot<토큰>/getUpdates` 호출 후 `chat.id` 확인
  - (봇 디버그) @userinfobot 사용해 본인/그룹 ID 확인
- 획득한 값을 `TELEGRAM_CHAT_ID` 로 저장 (여러 대상이면 콤마 구분 지원)

#### ③ 알림 테스트(예시)

- cURL:
  ```bash
  curl -X POST \
    "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
    -d chat_id="${TELEGRAM_CHAT_ID}" \
    -d text="[재고부족] 테스트 메세지: 제품A 남은수량 3 / 안전재고 10"
  ```
- 성공 시 텔레그램에 메시지 도착 → 앱에서 발송 로그에도 기록됨

#### ④ 운영 고려사항

- **보안:** 토큰은 .env + Secrets Manager에 저장, 로그 노출 금지
- **쿨다운:** 동일 품목 반복 알림 최소 간격(예: 60분)
- **심야 억제:** 22:00~07:00 사이 지연발송 옵션
- **장애 복구:** 실패 시 재시도(지수 백오프), 5회 실패 후 관리자 리포트

> 설정 위치: **환경설정 → 알림 설정**에서 토글/토큰/Chat ID/쿨다운/심야 억제/배치 주기 설정

---

**📌 다음 단계 제안:**

1. 텔레그램 봇 프로퍼티 키/보안 저장 방식 확정(.env + Secrets Manager)
2. 알림 쿨다운/배치 로직 상세화(시퀀스 다이어그램)
3. 제품 상세 화면에 안전재고 인라인 편집 UX 와이어프레임
